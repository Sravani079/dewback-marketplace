<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="text-center">Trade Market</h1>
    <%= link_to "ðŸ“¥ Trade Inbox", trade_inbox_path, class: "btn btn-outline-primary" %>
  </div>

  <% if @dewbacks.present? && @dewbacks.any? %>
    <div class="row">
      <% @dewbacks.each do |dewback| %>
        <% dewback.owners.each do |owner| %>
          <% next unless owner.available_for_trade %>

          <div class="col-md-4 mb-4">
            <div class="card h-100">
              <% if dewback.image_file&.attached? %>
                <%= image_tag url_for(dewback.image_file),
                              class: "card-img-top",
                              style: "max-height: 200px; object-fit: cover;" %>
              <% elsif dewback.image.present? %>
                <%= image_tag asset_path(dewback.image),
                              class: "card-img-top",
                              style: "max-height: 200px; object-fit: cover;" %>
              <% end %>

              <div class="card-body d-flex flex-column">
                <h5 class="card-title"><%= dewback.title %></h5>
                <p class="card-text text-truncate"><%= dewback.description %></p>

                <p class="mb-1">
                  <strong>Owner:</strong>
                  <%= owner.user.email %>
                </p>

                <div class="mt-auto">
                  <%= link_to 'View Details',
                              dewback_path(dewback),
                              class: "btn btn-primary btn-sm me-2" %>

                  <% if owner.user != current_user %>
                    <%= link_to 'Propose Trade',
                                new_trade_proposal_path(dewback_id: dewback.id),
                                class: "btn btn-success btn-sm" %>
                  <% else %>
                    <span class="text-muted small">Your Dewback</span>
                  <% end %>
                </div>
              </div>
            </div>
          </div>

        <% end %>
      <% end %>
    </div>
  <% else %>
    <p class="text-center text-muted">No Dewbacks are currently available for trade.</p>
  <% end %>
</div>
